<!DOCTYPE html>
<html>
  <head>
    <title>Counsellor Login</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body>
    <h2>Login with Gmail</h2>
    <div id="g_id_onload"
         data-client_id="887130931128-mevrb3v6ros4t6elaivotb4ggaksodig.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin"
         data-type="standard"
         data-shape="pill"
         data-theme="outline"
         data-text="signin_with"
         data-size="large">
    </div>

    <script>
      async function handleCredentialResponse(response) {
        const idToken = response.credential;

        // Send token to Apps Script backend
        try {
          const res = await fetch("https://script.google.com/macros/s/AKfycbyFhSnC7m9Bp5VeK8LmYs4tOkWHt5_wqcqn9ICuBDoE2Y4csve-kkg1T81vLAuLfAVu/exec", {
            method: "POST",
            headers: {
              "Authorization": "Bearer " + idToken,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ action: "getClients" })
          });

          const data = await res.json();
          if (data.status === "ok") {
            // Replace page with backend-rendered HTML
            document.open();
            document.write(data.html);
            document.close();
          } else {
            alert("Login failed: " + (data.error || "Unknown error"));
          }
        } catch (err) {
          console.error("Error contacting backend:", err);
          alert("⚠️ Could not reach backend.");
        }
      }
    </script>
  </body>
</html>
